<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Popmart Monitor Admin</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        {% if page == 'login' %}
            <h1>Admin Login</h1>
            {% with messages = get_flashed_messages() %}
                {% if messages %}
                    <div class="flash-messages">
                        {% for message in messages %}
                            <p>{{ message }}</p>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}
            <form method="post">
                <div class="form-group">
                    <label for="username">Username:</label>
                    <input type="text" id="username" name="username" required>
                </div>
                <div class="form-group">
                    <label for="password">Password:</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <button type="submit">Login</button>
            </form>
        {% else %}
            <h1>Popmart Monitor Admin</h1>
            {% with messages = get_flashed_messages() %}
                {% if messages %}
                    <div class="flash-messages">
                        {% for message in messages %}
                            <p>{{ message }}</p>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}
            
            <div class="section">
                <h2>Users</h2>
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Username</th>
                            <th>Balance</th>
                            <th>Created At</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user in users %}
                            <tr>
                                <td>{{ user[0] }}</td>
                                <td>{{ user[1] }}</td>
                                <td>${{ "%.2f"|format(user[2]) }}</td>
                                <td>{{ user[3] }}</td>
                                <td>
                                    <form method="post" action="{{ url_for('add_balance') }}" class="inline-form">
                                        <input type="hidden" name="user_id" value="{{ user[0] }}">
                                        <input type="number" name="amount" step="0.01" min="0.01" placeholder="Amount" required>
                                        <button type="submit">Add Balance</button>
                                    </form>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            <div class="section">
                <h2>Products</h2>
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Global Link</th>
                            <th>AU Link</th>
                            <th>Price</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for product in products %}
                            <tr>
                                <td>{{ product[0] }}</td>
                                <td>{{ product[1] }}</td>
                                <td>
                                    {% if product[2] %}
                                        <a href="{{ product[2] }}" target="_blank">Global Link</a>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if product[3] %}
                                        <a href="{{ product[3] }}" target="_blank">AU Link</a>
                                    {% endif %}
                                </td>
                                <td>${{ "%.2f"|format(product[4]) }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
                
                <h3>Add New Product</h3>
                <form method="post" action="{{ url_for('add_product') }}">
                    <div class="form-group">
                        <label for="product_id">Product ID:</label>
                        <input type="text" id="product_id" name="product_id" required>
                    </div>
                    <div class="form-group">
                        <label for="product_name">Product Name:</label>
                        <input type="text" id="product_name" name="product_name" required>
                    </div>
                    <div class="form-group">
                        <label for="global_link">Global Link:</label>
                        <input type="url" id="global_link" name="global_link">
                    </div>
                    <div class="form-group">
                        <label for="au_link">AU Link:</label>
                        <input type="url" id="au_link" name="au_link">
                    </div>
                    <div class="form-group">
                        <label for="price">Monitoring Price ($):</label>
                        <input type="number" id="price" name="price" step="0.01" min="0.01" required>
                    </div>
                    <button type="submit">Add Product</button>
                </form>
            </div>
            
            <div class="section">
                <h2>Active Monitoring</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Product ID</th>
                            <th>Product Name</th>
                            <th>Global Link</th>
                            <th>AU Link</th>
                            <th>Subscriber Count</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in monitoring %}
                            <tr>
                                <td>{{ item[0] }}</td>
                                <td>{{ item[1] }}</td>
                                <td>
                                    {% if item[2] %}
                                        <a href="{{ item[2] }}" target="_blank">Global Link</a>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if item[3] %}
                                        <a href="{{ item[3] }}" target="_blank">AU Link</a>
                                    {% endif %}
                                </td>
                                <td>{{ item[4] }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% endif %}
    </div>
</body>
</html>